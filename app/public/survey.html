<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>FriendFinder</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.4.3/css/bulma.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
</head>

<body>

    <section class="hero is-primary">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    Survey Questions
                </h1>
                <hr>
            </div>
        </div>
    </section>

    <section class="hero is-info">
        <div class="hero-body">
            <div class="container">
                <div class="field">
                    <label class="label" style="color:#fff">Name (Required)</label>
                    <p class="control has-icons-left">
                        <input class="input is-primary" id="name" type="text" placeholder="Enter your name here">
                        <span class="icon is-small is-left">
                            <i class="fa fa-user"></i>
                        </span>
                    </p>
                </div>

                <div class="field">
                    <label class="label" style="color:#fff">Photo Image (Required)</label>
                    <p class="control has-icons-left">
                        <input class="input is-primary" id="photo" type="text" placeholder="Past a link to a photo of yourself here">
                        <span class="icon is-small is-left">
                            <i class="fa fa-link"></i>
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </section>

    <br>

    <div class="columns is-multiline is-desktop ">
        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 1</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            Your mind is always buzzing with unexplored ideas and plans.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q1" data-q="Question 1">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>


        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 2</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            Generally speaking, you rely more on your experience than your imagination.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q2" data-q="Question 2">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 3</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            You find it easy to stay relaxed and focused even when there is some pressure.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q3" data-q="Question 3">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 4</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            You rarely do something just out of sheer curiosity.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q4" data-q="Question 4">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 5</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            People can rarely upset you.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q5" data-q="Question 5">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 6</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            It is often difficult for you to relate to other people’s feelings.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q6" data-q="Question 6">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 7</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            In a discussion, truth should be more important than people’s sensitivities.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q7" data-q="Question 7">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 8</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            You rarely get carried away by fantasies and ideas.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q8" data-q="Question 8">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 9</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            You think that everyone’s views should be respected regardless of whether they are supported by facts or not.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q9" data-q="Question 9">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>

        <div class="column is-8 is-offset-2">
            <section class="message is-info">
                <p class="message-header">Question 10</p>
                <div class="panel-block">
                    <div class="field">
                        <label class="label">
                            You feel more energetic after spending time with a group of people.
                        </label>
                        <p class="control">
                            <span class="select">
                                <select id="q10" data-q="Question 10">
                                    <option>Select answer</option>
                                    <option>1 (Strongly Disagree)</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5 (Strongly Agree)</option>
                                </select>
                            </span>
                        </p>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <section class="hero is-primary">
        <div class="hero-body">
            <div class="container has-text-centered">
                <a class="button is-info is-medium" id="submit">
                        <span class="icon">
                            <i class="fa fa-check-circle" aria-hidden="true"></i>
                        </span>
                        <span>Submit</span>
                    </a>
            </div>
        </div>
    </section>

    <div class="hero-foot">
        <div class="container">
            <div class="content has-text-centered">
                <br>
                <p>
                    <a href="/api/friends" target="_blank">API Friends List </a> |
                    <a href="https://github.com/Ruigrok/FriendFinder" target="_blank"> GitHub Repo</a>
                </p>
                <p>
                    <strong>FriendFinder</strong> by Andrew Ruigrok
                </p>
            </div>
        </div>
    </div>

    <div class="modal" id="input-modal">
        <div class="modal-background"></div>
        <div class="modal-content">

            <article class="message is-warning">
                <div class="message-header">
                    <p>Missing input for:</p>
                    <button class="delete modal1-reset"></button>
                </div>
                <div class="message-body" id="input-body">
                    <!-- populates with unaswered questions on submit -->
                </div>
            </article>

        </div>
        <button class="modal-close is-large modal1-reset"></button>
    </div>

    <div class="modal" id="results-modal">
        <div class="modal-background"></div>
        <div class="modal-content">
            <article class="message is-primary">
                <div class="message-header">
                    <h2><strong>Best Match</strong></h2>
                    <button class="delete reset"></button>
                </div>
                <div class="message-body has-text-centered" id="results-body">

                </div>
            </article>

        </div>
        <button class="modal-close is-large reset"></button>
    </div>

</body>

<script type="text/javascript">
    var newFriend;

    $('.modal1-reset').on('click', function () {
        $('#input-modal').removeClass('is-active');
    })

    $('.reset').on('click', function () {
        $('#results-body').empty();
        $('#results-modal').removeClass('is-active');
        $("#name").val("");
        $("#photo").val("");

        for (var i = 1; i < 11; i++) {
            console.log($("#q" + i).val());
            $("#q" + i).val("Select answer")
            //$(("#q" + i) + " " + "option:first").attr('selected', 'selected');
        }
    });

    $("#submit").on("click", function () {
        var answers = [];
        var unanswered = [];

        if ($('#name').val() === "") {
            unanswered.push("Name");
        }

        if ($('#photo').val() === "") {
            unanswered.push("Photo");
        }

        for (var i = 1; i < 11; i++) {
            var answer = $("#q" + i).val();

            switch (answer) {
                case "Select answer":
                    unanswered.push($("#q" + i).data("q"));

                case "1 (Strongly Disagree)":
                    answer = "1";
                    answers.push(answer);
                    break;

                case "5 (Strongly Agree)":
                    answer = "5";
                    answers.push(answer);
                    break;

                default:
                    answers.push(answer);
            }
        }

        if (unanswered.length) {
            var missing = $("<ul>");

            unanswered.forEach(function (x) {
                var item = $("<li>");
                item.text(x);
                missing.append(item);
            })

            $("#input-body").html(missing);
            $("#input-modal").addClass("is-active")

        } else {

            var newFriend = {
                name: $("#name").val().trim(),
                photo: $("#photo").val().trim(),
                scores: answers,
            };

            var results = [];
            var netScores = [];

            $.get("/api/friends", function (friendsData) {
                if (friendsData) {

                    var currentScores = newFriend.scores

                    for (var j = 0; j < friendsData.length; j++) {
                        var result = currentScores.map((a, i) => Math.abs(a - friendsData[j].scores[i]));
                        results.push(result);
                    }

                    for (var i = 0; i < results.length; i++) {
                        var netScore = results[i].reduce((a, b) => a + b);
                        netScores.push(netScore);
                    }

                    var lowestScore = Math.min.apply(Math, netScores);
                    var bestMatch = netScores.indexOf(lowestScore);

                    var matchName = friendsData[bestMatch].name;
                    var matchImage = friendsData[bestMatch].photo;

                    var match = $("<h2>");
                    match.addClass("title is-2");
                    match.html("<strong>" + matchName + "</strong>");

                    var imageDiv = $("<p>");
                    imageDiv.addClass("image");

                    var image = $("<img>");
                    image.attr("src", matchImage);

                    imageDiv.append(image);

                    $("#results-body").append(match);
                    $("#results-body").append(imageDiv);
                    $("#results-modal").addClass("is-active");

                }
            });

            $.post("/api/friends", newFriend)
                .done(function (data) {

                    if (data) {

                    }
                });
        }
    });

</script>

</html>